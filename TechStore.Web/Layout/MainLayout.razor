@using TechStore.Web.Services
@inherits LayoutComponentBase
@inject TechStore.Web.Services.AuthService Auth
@inject NavigationManager Nav
@inject NavigationManager Navigation
@inject CarrinhoService Carrinho
@inject AuthService Auth

<!-- NAVBAR -->
<div class="bg-dark text-white p-3 shadow">
    <div class="container d-flex justify-content-between align-items-center">

        <!-- LOGO -->
        <a href="/" class="text-white fw-bold text-decoration-none fs-4">
            💻 TechStore
        </a>

        <!-- MENU -->
        <div class="d-flex gap-3">
            <NavLink href="/" class="text-white text-decoration-none"> <i class="bi bi-house"></i> Início</NavLink>
            <NavLink href="/produtos" class="text-white text-decoration-none"> <i class="bi bi-grid"></i> Produtos</NavLink>
            <NavLink href="/carrinho" class="text-white text-decoration-none"> <i class="bi bi-cart"></i> Carrinho
                @if (Auth.IsAuthenticated && Carrinho.QuantidadeTotal > 0)
                {
                    <span class="badge bg-warning text-dark ms-1">
                        @Carrinho.QuantidadeTotal
                    </span>
                }
            </NavLink>
            
            @if (Auth.IsAuthenticated)
            {
                <span class="text-light">
                    Olá, @Auth.UserName
                </span>

                <button class="btn btn-outline-light btn-sm"
                        @onclick="Logout">
                    Sair
                </button>
            }
            else
            {
               <AuthorizeView>
                    <Authorized>
                        <div class="dropdown">
                            <a class="text-white text-decoration-none dropdown-toggle"
                               href="#"
                               role="button"
                               data-bs-toggle="dropdown"
                               aria-expanded="false">
                                <i class="bi bi-person-circle"></i> Olá, @Auth.UserName
                            </a>

                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <button class="dropdown-item text-danger"
                                            @onclick="Logout">
                                        <i class="bi bi-box-arrow-right"></i> Sair
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </Authorized>

                    <NotAuthorized>
                        <NavLink href="/login" class="text-white text-decoration-none"> <i class="bi bi-person"></i> Entrar</NavLink>
                    </NotAuthorized>
                </AuthorizeView>

            }
        </div>

    </div>
</div>

    <!-- CONTEÚDO PRINCIPAL --> 
    <main class="container mt-4">
        @Body
    </main>

    <!-- RODAPÉ SIMPLES -->
    <footer class="footer mt-5 py-3 bg-light border-top">
        <div class="container text-center">
            <p class="text-muted mb-0">
                &copy; 2026 TechStore - Desenvolvedora Daliene Roque 
            </p>
        </div>
    </footer>


@code {
    protected override void OnInitialized()
    {
        Auth.OnAuthChanged += StateHasChanged;
        Carrinho.OnCarrinhoChanged += StateHasChanged;
    }

    private async Task Logout()
    {
        await Auth.LogoutAsync();
        Nav.NavigateTo("/");
    }
}