@using TechStore.Web.Services
@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject CarrinhoService Carrinho
@inject AuthService Auth

<!-- NAVBAR -->
<div class="bg-dark text-white p-3 shadow">
    <div class="container d-flex justify-content-between align-items-center">

       

        <div class="container d-flex align-items-center justify-content-between">

            <!-- LOGO -->
            <a href="/" class="text-white fw-bold text-decoration-none fs-4">
                💻 TechStore
            </a>

            <!-- BUSCA -->
            <div class="search-box w-50">
                <input type="text"
                       class="form-control form-control-sm"
                       placeholder="Buscar produtos..."
                       @bind="termoPesquisa"
                       @bind:event="oninput"
                       @onkeydown="OnKeyDown" />
            </div>

        </div>

        <!-- MENU -->
        <div class="d-flex gap-3">
            <NavLink href="/" class="text-white text-decoration-none"> <i class="bi bi-house"></i> Início</NavLink>
            <NavLink href="/produtos" class="text-white text-decoration-none"> <i class="bi bi-grid"></i> Produtos</NavLink>
            <NavLink href="/carrinho" class="text-white text-decoration-none"> <i class="bi bi-cart"></i> Carrinho
                @if (Auth.IsAuthenticated && Carrinho.QuantidadeTotal > 0)
                {
                    <span class="badge bg-warning text-dark ms-1">
                        @Carrinho.QuantidadeTotal
                    </span>
                }
            </NavLink>
            
            @if (Auth.IsAuthenticated)
            {
                <NavLink class="nav-link text-white" href="/perfil"> <i class="bi bi-person"></i> Perfil</NavLink>

                <NavLink class="nav-link text-white" @onclick="Logout"><i class="bi bi-box-arrow-right"></i>Sair</NavLink>

                <span class="text-light">
                    Olá, @Auth.UserName
                </span>

                
            }
            else
            {
               <AuthorizeView>
                    <Authorized>
                        <div class="dropdown">
                             <span class="text-white d-flex align-items-center gap-1">
                                <i class="bi bi-person-circle fs-5"></i>
                                <span>
                                    Olá,
                                    <NavLink href="/login" class="text-white text-decoration-underline">
                                        Entre
                                    </NavLink>
                                    ou
                                    <NavLink href="/registrar" class="text-white text-decoration-underline">
                                        Cadastra-se
                                    </NavLink>
                                 </span>
                            </span>                          
                        </div>
                    </Authorized                   
                </AuthorizeView>

            }

            <AuthorizeView Roles="Admin">
                <Authorized>
                    <li class="nav-item px-3">
                        <NavLink class="nav-link" href="/admin">
                            <span class="bi bi-shield-lock"></span> Painel Admin
                        </NavLink>
                    </li>
                </Authorized>
            </AuthorizeView>

        </div>

    </div>
</div>

    <!-- CONTEÚDO PRINCIPAL --> 
    <main class="container mt-4">
        @Body
    </main>

    <!-- RODAPÉ SIMPLES -->
    <footer class="footer-tech mt-5">
    <div class="container py-5">
        <div class="row">

            <div class="col-md-4">
                <h4 class="footer-title">TechStore</h4>
                <p class="footer-text">
                    Sua loja de tecnologia com os melhores preços,
                    qualidade e entrega rápida.
                </p>
            </div>

            <div class="col-md-4">
                <h5 class="footer-subtitle">Links Rápidos</h5>
                <ul class="footer-links">
                    <li><NavLink href="/">Início</NavLink></li>
                    <li><NavLink href="/produtos">Produtos</NavLink></li>
                    <li><NavLink href="/carrinho">Carrinho</NavLink></li>
                </ul>
            </div>

            <div class="col-md-4">
                <h5 class="footer-subtitle">Contato</h5>
                <p class="footer-text">📧 contato@techstore.com</p>
                <p class="footer-text">📞 (31) 99999-9999</p>
            </div>

        </div>
    </div>

    <div class="footer-bottom text-center py-3">
        © 2026 TechStore - Engenheira de Software Daliene Roque
    </div>
</footer>


@code {
    [Inject] NavigationManager NavManager { get; set; }
     
    private string termoPesquisa = string.Empty;    

    private void OnKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !string.IsNullOrWhiteSpace(termoPesquisa))
        {
            NavManager.NavigateTo($"/produtos?search={termoPesquisa}");
        }
    }
    protected override void OnInitialized()
    {
        Auth.OnAuthChanged += StateHasChanged;
        Carrinho.OnCarrinhoChanged += StateHasChanged;
    }

    private async Task Logout()
    {
        await Auth.LogoutAsync();
        Navigation.NavigateTo("/");
    }


}