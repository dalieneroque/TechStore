@using TechStore.Web.Services
@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject CarrinhoService Carrinho
@inject AuthService Auth

<!-- NAVBAR -->
<div class="bg-dark text-white p-3 shadow">
    <div class="container d-flex justify-content-between align-items-center">

        <!-- LOGO -->
        <a href="/" class="text-white fw-bold text-decoration-none fs-4">
            💻 TechStore
        </a>

        <!-- MENU -->
        <div class="d-flex gap-3">
            <a href="/" class="text-white text-decoration-none"> <i class="bi bi-house"></i> Início</a>
            <a href="/produtos" class="text-white text-decoration-none"> <i class="bi bi-grid"></i> Produtos</a>
            <a href="/carrinho" class="text-white text-decoration-none"> <i class="bi bi-cart"></i> Carrinho
                @if (Auth.IsAuthenticated && Carrinho.QuantidadeTotal > 0)
                {
                    <span class="badge bg-warning text-dark ms-1">
                        @Carrinho.QuantidadeTotal
                    </span>
                }
            </a>
            
            @if (Auth.IsAuthenticated)
            {
                <span class="text-light">
                    Olá, @Auth.UserName
                </span>

                <button class="btn btn-outline-light btn-sm"
                        @onclick="Logout">
                    Sair
                </button>
            }
            else
            {
                <NavLink href="/login" class="text-white text-decoration-none"> <i class="bi bi-person"></i> Entrar</NavLink>
            }
        </div>

    </div>
</div>

    <!-- CONTEÚDO PRINCIPAL --> 
    <main class="container mt-4">
        @Body
    </main>

    <!-- RODAPÉ SIMPLES -->
    <footer class="footer mt-5 py-3 bg-light border-top">
        <div class="container text-center">
            <p class="text-muted mb-0">
                &copy; 2026 TechStore - Desenvolvedora Daliene Roque 
            </p>
        </div>
    </footer>


@code {
    protected override void OnInitialized()
    {
        Auth.OnAuthChanged += StateHasChanged;
        Carrinho.OnCarrinhoChanged += StateHasChanged;
    }

    private async Task Logout()
    {
        await Auth.LogoutAsync();
        Navigation.NavigateTo("/");
    }
}